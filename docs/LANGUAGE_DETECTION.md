# 自动语言检测系统

本项目实现了智能的多语言检测和缓存系统，能够根据用户的地理位置、浏览器偏好和历史选择自动选择最合适的语言。

## 检测优先级

系统按以下优先级检测和设置语言：

### 1. 缓存优先 (最高优先级)
- 检查 `localStorage.userLocale`
- 如果用户之前手动选择过语言，直接使用
- 确保用户的主动选择始终被尊重

### 2. 地理位置检测 (第二优先级)
- 通过 IP 地址检测用户所在国家/地区
- 使用两个备用 API 确保可靠性：
  - 主 API: `https://ipapi.co/json/`
  - 备用 API: `https://ipinfo.io/json`
- 3秒超时机制，避免影响页面加载速度

### 3. 浏览器语言 (第三优先级)
- 检测 `navigator.language`
- 匹配支持的语言代码
- 作为地理位置检测失败时的备选方案

### 4. 默认语言 (最低优先级)
- 如果以上方法都失败，使用英语 (en)
- 确保系统始终有可用的语言设置

## 支持的语言映射

### 国家/地区 → 语言映射

```typescript
const countryToLanguage = {
  // 中文地区
  'CN': 'zh',  // 中国大陆
  'TW': 'zh',  // 台湾
  'HK': 'zh',  // 香港
  'MO': 'zh',  // 澳门
  'SG': 'zh',  // 新加坡
  
  // 俄语地区
  'RU': 'ru',  // 俄罗斯
  'BY': 'ru',  // 白俄罗斯
  'KZ': 'ru',  // 哈萨克斯坦
  'KG': 'ru',  // 吉尔吉斯斯坦
  'UZ': 'ru',  // 乌兹别克斯坦
  'TJ': 'ru',  // 塔吉克斯坦
  
  // 法语地区
  'FR': 'fr',  // 法国
  'BE': 'fr',  // 比利时
  'CH': 'fr',  // 瑞士
  'CA': 'fr',  // 加拿大
  'MC': 'fr',  // 摩纳哥
  'LU': 'fr',  // 卢森堡
  
  // 泰语地区
  'TH': 'th',  // 泰国
  
  // 其他国家默认使用英语
}
```

## 缓存机制

### 自动缓存
- 检测到的语言自动保存到 `localStorage.userLocale`
- 下次访问时优先使用缓存的语言

### 手动覆盖
- 用户通过语言切换器选择语言时
- 新选择会覆盖自动检测的结果
- 保证用户主动选择的语言始终生效

## 性能优化

### 超时机制
- IP 地理位置检测设置 3秒超时
- 避免网络问题影响页面加载速度
- 超时后自动使用浏览器语言备选方案

### 备用 API
- 两个独立的地理位置 API
- 提高检测成功率和可靠性
- 主 API 失败时自动尝试备用 API

### 客户端执行
- 所有检测逻辑仅在客户端执行
- 不影响服务端渲染性能
- 确保用户隐私安全

## 用户体验

### 无感知切换
- 首次访问自动检测并设置语言
- 无需用户手动操作
- 提供直观的语言切换界面

### 记忆功能
- 记住用户的语言偏好
- 跨会话保持语言设置
- 减少重复操作

### 引导适配
- 新手引导自动使用检测到的语言
- 提供本地化的使用指导
- 优化国际用户体验

## 技术实现

### 插件架构
- `plugins/auto-locale.client.ts`: 自动语言检测
- `plugins/i18n.js`: 国际化框架配置
- `components/LanguageSwitch.vue`: 语言切换界面

### 错误处理
- 网络请求异常处理
- API 失败时的备选方案
- 确保系统稳定性

### 类型安全
- TypeScript 类型检查
- 防止运行时错误
- 提高代码质量 